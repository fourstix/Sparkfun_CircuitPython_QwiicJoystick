# This is a common .travis.yml for generating library release zip files for
# CircuitPython library releases using circuitpython-build-tools.
# See https://github.com/adafruit/circuitpython-build-tools for detailed setup
# instructions.

dist: xenial
language: python
python:
  - "3.6"

cache:
  pip: true

# TODO: if deployment to PyPi is desired, change 'DEPLOY_PYPI' to "true",
#       or remove the env block entirely and remove the condition in the
#       deploy block.
env:
  - DEPLOY_PYPI="false"

deploy:
  - provider: releases
    api_key: "$GITHUB_TOKEN"
    file_glob: true
    file: "$TRAVIS_BUILD_DIR/bundles/*"
    skip_cleanup: true
    overwrite: true
    on:
      tags: true
  # Use 'travis encrypt --com -r adafruit/<repo slug>' to generate
  #       the encrypted password for adafruit-travis. Paste result below.
  - provider: pypi
    user: fourstix
    password:
      secure: "bocArgPi5b6mIJ1nZFS1srxVkJzHl8xZ+p7EkXTc7wWWh/l3qE3A7FR31sCDHGAEr9EouqmbzMLMj4HHlPseO/3XQa4TlhZDz1A+eo/zqBjIr18kxEEVv0dcWIOKvZFCdkui3md/X/j/zNcCwJ313SgbbW4hN8fvnb9FSYSRb/n2I4O8o1GUuFZXU8ntqNmHr0kVkDryqMUk2rYktRaWH174TD/g8RDXzpp84tpePsFxcYdVxmZ5IwzUEqM2HTU65R6pHpIbR2mywJ3i9Atvq+Y0ulk7hMeA1OvPKinpRaL/yyKFjTMcW0gLscaR+LqVPGZmvf+DEhmt9MolARrGRfEzJhHKggjOT3LOigV/0P5OeUI3go9sneMv/Em7VD/za+hZLK198gGwAepJBltqk4PnQTPkPwVy8DhXV5cALyLvQHz6XTqGgeB9g66JOLYhuuUSTFQqZtwg+8PhwJ8W5LQxmKeE2ohulfrq7jSPt+FVsvCZc87Z463iqAFZ4RqZLnn8td1Ye582FES0by1GO0TCKouWGj9U4SRUcfhmnd7/mZQZzBN+cyPyBN0Hb4xqSGfOGpHw7M+A6+QKiyMV6EkvB/Nu2g7Q4ZLKiNoBy3uf5X1fFY+WBUeal9l0NQtgJtB5/5mPscoH8fLoIfFHqj5IBbjV54SG/OIjzcpYsUc="
    on:
      tags: true
      condition: $DEPLOY_PYPI = "true"

install:
  - pip install -r requirements.txt
  - pip install circuitpython-build-tools Sphinx sphinx-rtd-theme
  - pip install --force-reinstall pylint==1.9.2

script:
  - pylint sparkfun_qwiicjoystick.py
  - ([[ ! -d "examples" ]] || pylint --disable=missing-docstring,invalid-name,bad-whitespace examples/*.py)
  - circuitpython-build-bundles --filename_prefix sparkfun-circuitpython-qwiicjoystick --library_location .
  - cd docs && sphinx-build -E -W -b html . _build/html && cd ..
